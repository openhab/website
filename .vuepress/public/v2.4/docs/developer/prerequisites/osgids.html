<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OSGi Declarative Services | openHAB</title>
    <meta name="description" content="openHAB - a vendor and technology agnostic open source automation software for your home">
    <link rel="stylesheet" href="/v2.4/fonts/fonts.css">
  <link rel="icon" href="/v2.4/favicon.ico">
  <link rel="shortcut icon" href="/v2.4/favicon.ico">
  <link rel="apple-touch-icon" href="/v2.4/apple-icon.png">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://www.openhab.org/og-image.png">
    <meta property="og:title" content="OSGi Declarative Services"><meta property="og:description" content="a vendor and technology agnostic open source automation software for your home">
    <link rel="preload" href="/v2.4/assets/css/0.styles.a3a5c47b.css" as="style"><link rel="preload" href="/v2.4/assets/js/app.1cb1e7e9.js" as="script"><link rel="preload" href="/v2.4/assets/js/456.09c22ffe.js" as="script"><link rel="preload" href="/v2.4/assets/js/6.b424a272.js" as="script"><link rel="preload" href="/v2.4/assets/js/7.dad7d623.js" as="script">
    <link rel="stylesheet" href="/v2.4/assets/css/0.styles.a3a5c47b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v2.4/" class="home-link router-link-active"><img src="/v2.4/openhab-logo.png" alt="openHAB" class="logo"> <span class="site-name can-hide">openHAB</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/v2.4/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/v2.4/download/" class="nav-link">Download</a></div><div class="nav-item"><a href="/v2.4/docs/" class="nav-link router-link-active">Documentation</a></div><div class="nav-item"><a href="/v2.4/addons/" class="nav-link">Add-ons</a></div><div class="nav-item"><a href="/v2.4/community/" class="nav-link">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">About</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Get Involved</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/v2.4/about/who-we-are.html" class="nav-link">Who We Are</a></li><li class="dropdown-subitem"><a href="/v2.4/about/contributing.html" class="nav-link">Contribute</a></li><li class="dropdown-subitem"><a href="/v2.4/about/events.html" class="nav-link">Events</a></li></ul></li><li class="dropdown-item"><h4>Support openHAB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://openhabfoundation.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Foundation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/v2.4/about/donate.html" class="nav-link">Donate</a></li></ul></li><li class="dropdown-item"><h4>Resources</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/v2.4/about/showcase.html" class="nav-link">Showcase/How-tos</a></li><li class="dropdown-subitem"><a href="/v2.4/privacy.html" class="nav-link">Privacy Policy</a></li><li class="dropdown-subitem"><a href="https://www.myopenhab.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  myopenHAB
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/openhab" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/v2.4/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/v2.4/download/" class="nav-link">Download</a></div><div class="nav-item"><a href="/v2.4/docs/" class="nav-link router-link-active">Documentation</a></div><div class="nav-item"><a href="/v2.4/addons/" class="nav-link">Add-ons</a></div><div class="nav-item"><a href="/v2.4/community/" class="nav-link">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">About</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Get Involved</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/v2.4/about/who-we-are.html" class="nav-link">Who We Are</a></li><li class="dropdown-subitem"><a href="/v2.4/about/contributing.html" class="nav-link">Contribute</a></li><li class="dropdown-subitem"><a href="/v2.4/about/events.html" class="nav-link">Events</a></li></ul></li><li class="dropdown-item"><h4>Support openHAB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://openhabfoundation.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Foundation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/v2.4/about/donate.html" class="nav-link">Donate</a></li></ul></li><li class="dropdown-item"><h4>Resources</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/v2.4/about/showcase.html" class="nav-link">Showcase/How-tos</a></li><li class="dropdown-subitem"><a href="/v2.4/privacy.html" class="nav-link">Privacy Policy</a></li><li class="dropdown-subitem"><a href="https://www.myopenhab.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  myopenHAB
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/openhab" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Welcome to openHAB</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.4/docs/" class="sidebar-link">Introduction</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Concepts</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.4/docs/concepts/" class="sidebar-link">Concepts Overview</a></li><li><a href="/v2.4/docs/concepts/things.html" class="sidebar-link">Things</a></li><li><a href="/v2.4/docs/concepts/items.html" class="sidebar-link">Items</a></li><li><a href="/v2.4/docs/concepts/discovery.html" class="sidebar-link">Thing Discovery</a></li><li><a href="/v2.4/docs/concepts/audio.html" class="sidebar-link">Audio &amp; Voice</a></li><li><a href="/v2.4/docs/concepts/units-of-measurement.html" class="sidebar-link">Units Of Measurement</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Installation Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.4/docs/installation/" class="sidebar-link">Installation Overview</a></li><li><a href="/v2.4/docs/installation/linux.html" class="sidebar-link">Linux</a></li><li><a href="/v2.4/docs/installation/windows.html" class="sidebar-link">Windows</a></li><li><a href="/v2.4/docs/installation/macos.html" class="sidebar-link">macOS</a></li><li><a href="/v2.4/docs/installation/openhabian.html" class="sidebar-link">openHABian</a></li><li><a href="/v2.4/docs/installation/rasppi.html" class="sidebar-link">Raspberry Pi</a></li><li><a href="/v2.4/docs/installation/pine.html" class="sidebar-link">PINE A64</a></li><li><a href="/v2.4/docs/installation/docker.html" class="sidebar-link">Docker</a></li><li><a href="/v2.4/docs/installation/synology.html" class="sidebar-link">Synology DiskStation</a></li><li><a href="/v2.4/docs/installation/qnap.html" class="sidebar-link">QNAP NAS</a></li><li><a href="/v2.4/docs/installation/security.html" class="sidebar-link">Security</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>New User Tutorial</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.4/docs/tutorial/" class="sidebar-link">Tutorial Overview</a></li><li><a href="/v2.4/docs/tutorial/1sttimesetup.html" class="sidebar-link">First-time setup of openHAB</a></li><li><a href="/v2.4/docs/tutorial/uis.html" class="sidebar-link">openHAB UIs</a></li><li><a href="/v2.4/docs/tutorial/configuration.html" class="sidebar-link">Configuration of openHAB</a></li><li><a href="/v2.4/docs/tutorial/sitemap.html" class="sidebar-link">Creating a sitemap</a></li><li><a href="/v2.4/docs/tutorial/rules.html" class="sidebar-link">Working with rules and scripts</a></li><li><a href="/v2.4/docs/tutorial/logs.html" class="sidebar-link">Looking to the logs</a></li><li><a href="/v2.4/docs/tutorial/persistence.html" class="sidebar-link">Persistence</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Configuration Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.4/docs/configuration/" class="sidebar-link">Configuration Overview</a></li><li><a href="/v2.4/docs/configuration/addons.html" class="sidebar-link">Installation of Add-ons</a></li><li><a href="/v2.4/docs/configuration/things.html" class="sidebar-link">Things</a></li><li><a href="/v2.4/docs/configuration/items.html" class="sidebar-link">Items</a></li><li><a href="/v2.4/docs/configuration/sitemaps.html" class="sidebar-link">Sitemaps</a></li><li><a href="/v2.4/docs/configuration/persistence.html" class="sidebar-link">Persistence</a></li><li><a href="/v2.4/docs/configuration/rules-dsl.html" class="sidebar-link">Rules</a></li><li><a href="/v2.4/docs/configuration/transformations.html" class="sidebar-link">Transformation Services</a></li><li><a href="/v2.4/docs/configuration/actions.html" class="sidebar-link">Actions</a></li><li><a href="/v2.4/docs/configuration/iconsets/classic/" class="sidebar-link">Icons</a></li><li><a href="/v2.4/docs/configuration/jsr223.html" class="sidebar-link">JSR223 Scripting</a></li><li><a href="/v2.4/docs/configuration/services.html" class="sidebar-link">Services</a></li><li><a href="/v2.4/docs/configuration/multimedia.html" class="sidebar-link">Multimedia</a></li><li><a href="/v2.4/docs/configuration/migration/" class="sidebar-link">Migration from 1.x</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Interfaces and Ecosystem</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.4/docs/configuration/packages.html" class="sidebar-link">Initial Setup - Package Selection</a></li><li><a href="/v2.4/docs/configuration/editors.html" class="sidebar-link">Editors</a></li><li><a href="/v2.4/docs/configuration/homebuilder.html" class="sidebar-link">Home Builder</a></li><li><a href="/v2.4/docs/configuration/paperui.html" class="sidebar-link">Paper UI</a></li><li><a href="/v2.4/docs/configuration/ui/habmin/" class="sidebar-link">HABmin</a></li><li><a href="/v2.4/docs/configuration/ui/habot/" class="sidebar-link">HABot</a></li><li><a href="/v2.4/docs/configuration/habpanel.html" class="sidebar-link">HABPanel</a></li><li><a href="/v2.4/docs/configuration/ui/basic/" class="sidebar-link">Basic UI</a></li><li><a href="/v2.4/docs/configuration/ui/classic/" class="sidebar-link">Classic UI</a></li><li><a href="/v2.4/docs/configuration/rules-ng.html" class="sidebar-link">Next-Gen Rules</a></li><li><a href="/v2.4/docs/configuration/eclipseiotmarket.html" class="sidebar-link">Eclipse IoT Marketplace</a></li><li><a href="/v2.4/docs/configuration/restdocs.html" class="sidebar-link">REST API</a></li><li><a href="/v2.4/docs/apps/android.html" class="sidebar-link">Android App</a></li><li><a href="/v2.4/docs/apps/ios.html" class="sidebar-link">iOS App</a></li><li><a href="/v2.4/docs/apps/windows.html" class="sidebar-link">Windows 10 App</a></li><li><a href="/v2.4/docs/ecosystem/alexa/" class="sidebar-link">Amazon Alexa</a></li><li><a href="/v2.4/docs/ecosystem/google-assistant/" class="sidebar-link">Google Assistant</a></li><li><a href="/v2.4/addons/integrations/homekit/" class="sidebar-link">Apple HomeKit</a></li><li><a href="/v2.4/docs/ecosystem/ifttt/" class="sidebar-link">IFTTT</a></li><li><a href="/v2.4/docs/ecosystem/mycroft/" class="sidebar-link">Mycroft.AI</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Administration Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.4/docs/administration/" class="sidebar-link">Advanced Functionality and Administrative Tasks</a></li><li><a href="/v2.4/docs/administration/console.html" class="sidebar-link">The Console</a></li><li><a href="/v2.4/docs/administration/runtime.html" class="sidebar-link">Runtime Commands</a></li><li><a href="/v2.4/docs/administration/bundles.html" class="sidebar-link">Bundle Management</a></li><li><a href="/v2.4/docs/administration/logging.html" class="sidebar-link">Logging</a></li><li><a href="/v2.4/docs/administration/jsondb.html" class="sidebar-link">JsonDB Storage</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Developer Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.4/docs/developer/" class="sidebar-link">Development Overview</a></li><li><a href="/v2.4/docs/developer/contributing/contributing.html" class="sidebar-link">Contribution</a></li><li><a href="/v2.4/docs/developer/prerequisites/osgi.html" class="sidebar-link">OSGi</a></li><li><a href="/v2.4/docs/developer/prerequisites/osgids.html" class="active sidebar-link">OSGi Declarative Services</a></li><li><a href="/v2.4/docs/developer/prerequisites/configadmin.html" class="sidebar-link">Configuration Admin</a></li><li><a href="/v2.4/docs/developer/prerequisites/osgitasks.html" class="sidebar-link">Coding tasks for OSGi</a></li><li><a href="/v2.4/docs/developer/prerequisites/eventadmin.html" class="sidebar-link">Event Admin</a></li><li><a href="/v2.4/docs/developer/prerequisites/tycho.html" class="sidebar-link">Tycho</a></li><li><a href="/v2.4/docs/developer/prerequisites/equinox.html" class="sidebar-link">Equinox</a></li><li><a href="/v2.4/docs/developer/prerequisites/targetplatform.html" class="sidebar-link">Target platform</a></li><li><a href="/v2.4/docs/developer/development/ide.html" class="sidebar-link">IDE setup</a></li><li><a href="/v2.4/docs/developer/development/guidelines.html" class="sidebar-link">Coding Guidelines</a></li><li><a href="/v2.4/docs/developer/development/conventions.html" class="sidebar-link">Conventions</a></li><li><a href="/v2.4/docs/developer/development/bindings.html" class="sidebar-link">Developing bindings</a></li><li><a href="/v2.4/docs/developer/development/logging.html" class="sidebar-link">Logging</a></li><li><a href="/v2.4/docs/developer/development/evolution.html" class="sidebar-link">Evolution</a></li><li><a href="/v2.4/docs/developer/development/compatibilitylayer.html" class="sidebar-link">Compatibility</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="declarative-services"><a href="#declarative-services" aria-hidden="true" class="header-anchor">#</a> Declarative Services</h1> <h2 id="table-of-contents"><a href="#table-of-contents" aria-hidden="true" class="header-anchor">#</a> Table of contents</h2> <p></p><div class="table-of-contents"><ul><li><a href="#table-of-contents">Table of contents</a></li><li><a href="#i-introduction">I. Introduction</a></li><li><a href="#ii-declarative-services">II. Declarative Services</a><ul><li><a href="#_1-ds-container">1. DS container</a></li><li><a href="#_2-components">2. Components</a></li><li><a href="#_3-component-description">3. Component Description</a></li></ul></li><li><a href="#iii-advantages">III. Advantages</a></li><li><a href="#iv-example-reference-service">IV. Example - Reference Service</a><ul><li><a href="#_1-service-component-description">1. Service Component Description</a></li><li><a href="#_2-implementation-class">2. Implementation Class</a></li><li><a href="#_3-service-component-header">3. Service-Component Header</a></li></ul></li><li><a href="#v-example-provide-service">V. Example - Provide Service</a><ul><li><a href="#_1-component-description">1. Component Description</a></li><li><a href="#_2-implementation-class">2. Implementation Class</a></li><li><a href="#_3-service-component-header">3. Service-Component Header</a></li></ul></li><li><a href="#vi-component-types">VI. Component types</a></li><li><a href="#vii-component-lifecycle">VII. Component Lifecycle</a><ul><li><a href="#_1-states">1. States</a></li><li><a href="#_2-activation">2. Activation</a></li><li><a href="#_3-deactivation">3. Deactivation</a></li></ul></li><li><a href="#viii-troubleshooting">VIII. Troubleshooting</a></li><li><a href="#xix-further-reading">XIX. Further Reading</a></li></ul></div><p></p> <h2 id="i-introduction"><a href="#i-introduction" aria-hidden="true" class="header-anchor">#</a> I. Introduction</h2> <p>The OSGi Declarative Services functionality is part of the <a href="https://osgi.org/download/r4v42/r4.cmpn.pdf" target="_blank" rel="noopener noreferrer">OSGi 4.2 Compendium Specification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and allows you to define and consume services via metadata (XML) without any dependency in your source code to the OSGi framework.</p> <h2 id="ii-declarative-services"><a href="#ii-declarative-services" aria-hidden="true" class="header-anchor">#</a> II. Declarative Services</h2> <p>In the <a href="/v2.4/docs/developer/prerequisites/osgi.html">OSGi Overview article</a> we have mentioned that a bundle can register, unregister, get and unget services from a central point - the Service Registry. In order to simplify the usage of services the <a href="https://www.osgi.org/about-us/" target="_blank" rel="noopener noreferrer">OSGi Alliance<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> has developed a model of managing services dynamically called <em>Declarative Services</em>. In order to understand this model, we will have to first explain a few terms, used below:</p> <ul><li><strong>Declarative Services Container</strong> (we will use the shorthand <strong>DS</strong>) - a module that is managing the <a href="#vii-component-lifecycle">lifecycle</a> of a <em>service component</em> dynamically. It activates and deactivates different components, basing its decisions on the information contained in the <em>component description</em>;</li> <li><strong>Service Component</strong> (or also <strong>component</strong>) - an object whose lifecycle is managed, usually by a component framework such as Declarative Services (DS). A component may publish itself as an OSGi service or consume OSGi services. A component can refer to a number of services;</li> <li><strong>Component Description</strong> - The declaration of a component. It is contained
within an XML document in a bundle. (Source: <a href="https://osgi.org/download/r4v42/r4.cmpn.pdf" target="_blank" rel="noopener noreferrer">OSGi Service Platform Service Compendium Chapter 112.1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</li></ul> <h3 id="_1-ds-container"><a href="#_1-ds-container" aria-hidden="true" class="header-anchor">#</a> 1. DS container</h3> <p>In order to use the Declarative Services functionality you have to start a bundle with an implementation of the DS container. In <a href="http://www.eclipse.org/equinox/" target="_blank" rel="noopener noreferrer">Equinox<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (the reference implementation of OSGi that is used in openHAB) this bundle is called <code>org.eclipse.equinox.ds</code>.</p> <p>When a bundle that contains a component is added to the framework, DS reads its component description (the XML file). If the conditions, described in this file are fulfilled (you will understand more about this in the next chapters), the DS activates the component (more on the that in the <a href="#vii-component-lifecycle">component lifecycle</a> chapter). More importantly, after some of the requirements are not met anymore, the DS container deactivates the component. This ensures that service components are managed dynamically.</p> <h3 id="_2-components"><a href="#_2-components" aria-hidden="true" class="header-anchor">#</a> 2. Components</h3> <p>It is important to understand the difference between a <em>component</em> and a <em>service</em>. A component is a normal Java class, that can reference services and provide services. What makes a component specific is that it is declared in a XML file and is managed completely by DS. That means that DS instantiates the component, calls method on this component and manages the lifecycle of a component.</p> <p>A component requires the following artifacts in a bundle:</p> <ul><li><strong>XML description</strong> of the component;</li> <li><strong>Service-Component manifest header</strong>, which contains the location of the XML description;</li> <li>An <strong>implementation class</strong> that is specified in the component description.</li></ul> <p>In the examples below we will take a look over more details.</p> <p>For more detailed definition - <a href="https://osgi.org/download/r4v42/r4.cmpn.pdf" target="_blank" rel="noopener noreferrer">OSGi Service Platform Service Compendium Chapter 112.1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="_3-component-description"><a href="#_3-component-description" aria-hidden="true" class="header-anchor">#</a> 3. Component Description</h3> <p>The component description is a XML document that contains the <em>service component description</em> . The syntax of this document is described in <a href="https://osgi.org/download/r4v42/r4.cmpn.pdf" target="_blank" rel="noopener noreferrer">Component Description Schema, OSGi 4.2 Compendium 112.10<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. The  document contains basic information like the component name, component dependencies and services that are implemented by the component. It also describes, how the DS will handle changes in some of the referenced services and how the service will be activated (<a href="https://www.osgi.org/developer/design/lazy-start/" target="_blank" rel="noopener noreferrer">lazy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or not). We will provide some examples below, that cover the most common use cases.</p> <h2 id="iii-advantages"><a href="#iii-advantages" aria-hidden="true" class="header-anchor">#</a> III. Advantages</h2> <p>For the user of the service it is from no importance, if the service was registered with the <a href="https://osgi.org/javadoc/r4v43/core/org/osgi/framework/BundleContext.html#registerService(java.lang.Class,%20S,%20java.util.Dictionary)" target="_blank" rel="noopener noreferrer">low level API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or with Declarative Services. However the using of Declarative Services has the following advantages:</p> <ul><li><strong>they are declarative</strong> - it is not needed to write explicit code to register and get services. This means that a lot of boilerplate code can be removed and the developer can concentrate on the business logic;</li> <li><strong>DS container manages the creation of instances</strong> - whenever the conditions, described in the <em>component description</em>, are satisfied <em>DS</em> will instantiate the service for us. When the instances are not needed anymore, <em>DS</em> will remove the references to them;</li> <li><strong>components are not initialized until a service is requested</strong> - this is called <a href="https://www.osgi.org/developer/design/lazy-start/" target="_blank" rel="noopener noreferrer">lazy initialization<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and it is the default behavior;</li> <li><strong>a component has a lifecycle, that is bound to the defining bundle's lifecycle</strong> - more information can be found in the chapter <a href="#vii-component-lifecycle">component lifecycle</a>.</li></ul> <p>Components have two most common use cases (which are combined very often):</p> <ul><li>a component can <a href="#iv-example---reference-service">use services</a> from other components;</li> <li>a component can <a href="#v-example---provide-service">publish itself as an OSGi service</a>.</li></ul> <h2 id="iv-example-reference-service"><a href="#iv-example-reference-service" aria-hidden="true" class="header-anchor">#</a> IV. Example - Reference Service</h2> <p>In this example our component needs a <a href="https://osgi.org/javadoc/r4v42/org/osgi/service/log/LogService.html" target="_blank" rel="noopener noreferrer">LogService<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. We will use DS to inject an implementation of this service in our class.</p> <h3 id="_1-service-component-description"><a href="#_1-service-component-description" aria-hidden="true" class="header-anchor">#</a> 1. Service Component Description</h3> <p>This is the XML component description. This file is located in the <em>OSGI-INF</em> folder and is named <em>consumer.xml</em>.</p> <pre><code>Note! Please keep in mind that the Service Component Description can be
automatically generated using SCR Annotations like @Component, @Reference,
@Activate, @Deacticate and etc that are supported e.g. in Apache Felix. In the openHAB project
it is preferred to use these annotations and not create the XML component description by hand.
This should be accompanied with a .gitignore file in the OSGI-INF with /*.xml as content.
This is needed to avoid adding the generated XML component files to git.
</code></pre> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">scr:</span>component</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>scr</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.osgi.org/xmlns/scr/v1.1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.example.consumer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">immediate</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token comment">&lt;!-- name = the component name must be unique
        immediate = optional parameter that specifies if the component has immediate activation. Options are true or false              
   --&gt;</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>implementation</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.example.consumer.MyServiceImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span> 
   <span class="token comment">&lt;!--The fully qualified name of the implemenation class--&gt;</span>
   <span class="token comment">&lt;!--Here we declare references to other services, which we want to use in our implementation class. 
        bind = method in the implementation class which is called when the referenced services gets active
        unbind = method in the implementation class which is called when the referenced services gets inactive
        cardinality = regarding the cardinality of your reference DS handles the lifecycle of your servive as well
        policy = this reference can be handled as static or dynamic
    --&gt;</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reference</span> 
        <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.osgi.service.log.LogService<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>setLog<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">unbind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>unsetLog<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">cardinality</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1..1<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">policy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>static<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">scr:</span>component</span><span class="token punctuation">&gt;</span></span> 
</code></pre></div><p>Let's take a look at some settings, that we can apply:</p> <ul><li><strong>immediate</strong>:
<ul><li><em>true</em> - the component is activated as soon as all dependencies are satisfied. Adding this option will ensure that the component will be activated right after the bundle is activated and the component is satisfied;</li> <li><em>false</em> - the component has lazy activation. The activation of the component is delayed(lazy activation) until the service is requested. This is the default value;</li></ul></li> <li><strong>cardinality</strong>:
<ul><li><em>1..1</em> - single service reference, that is mandatory. If your referenced service gets inactive, DS deactivates your service component as well (default value);</li> <li><em>0..1</em> - single service reference(not mandatory). You have to be aware that you might not have your reference resolved, your component can live with the absence;</li> <li><em>0..n</em> - multiple service references (not mandatory). The referenced service can be implemented multiple times, so they are added to a list in your component implementation;</li> <li><em>1..n</em> = like the above, but mandatory;</li></ul></li> <li><strong>policy</strong>:
<ul><li><em>static</em> - the default policy. Component configuration are deactivated every time, when a reference with static policy becomes unavailable. This causes the activating and deactivating of the component. It can be very expensive, when we have multiple bound services, or when a service is often unregistered and re-registered;</li> <li><em>dynamic</em> - with this policy the component is not deactivated, when a referenced service is changed. It is slightly more complex, as the component implementation has to properly handle changes in the set of bound services.</li></ul></li></ul> <h3 id="_2-implementation-class"><a href="#_2-implementation-class" aria-hidden="true" class="header-anchor">#</a> 2. Implementation Class</h3> <p>Most of the bundles will require access to other services. A component may be used to inject the service in the bundle through the <code>bind()</code> and <code>unbind()</code> methods called on the component instance (the implementation class). In the component description above, we have set that our <code>bind()</code> method is named <code>setLog()</code>, so now we can inspect an instance of the <em>LogService</em> provided by the DS. The <code>activate()</code> and <code>deactivate()</code> methods are called from DS, when the component configuration is activated and deactivated (more about <a href="/v2.4/docs/developer/prerequisites/osgids.html#activaiton">activation</a>):</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>consumer<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>osgi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>BundleContext<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>osgi<span class="token punctuation">.</span>service<span class="token punctuation">.</span>log<span class="token punctuation">.</span>LogService<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>service <span class="token operator">=</span> MyServiceImpl<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> immediate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServiceImpl</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> LogService log<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">MyServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Activate</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">activate</span><span class="token punctuation">(</span>BundleContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Bundle is activated!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// No specific action is needed here in this case</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Deactivate</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">deactivate</span><span class="token punctuation">(</span>BundleContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Bundle is deactivated!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// No specific action is needed here in this case</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Reference</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLog</span><span class="token punctuation">(</span>LogService l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log <span class="token operator">=</span> l<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Log service is available!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// We store a reference to the LogService !</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unsetLog</span><span class="token punctuation">(</span>LogService l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log <span class="token operator">=</span> null<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Log service isn`t available anymore!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// We have to clean up after ourselves, when the reference is not needed anymore !</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-service-component-header"><a href="#_3-service-component-header" aria-hidden="true" class="header-anchor">#</a> 3. Service-Component Header</h3> <ul><li>The purpose of the <em>Service-Component</em> header in the MANIFEST.MF file is to show the DS container, where the component description is located. According to the OSGi specification, such resources must be placed in the <em>OSGI-INF</em> folder:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: Consumer Example
Bundle-SymbolicName: com.example.consumer
Bundle-Version: 1.0.0.qualifier
Bundle-RequiredExecutionEnvironment: JavaSE-1.7
Import-Package: org.osgi.framework,
 org.osgi.service.log
Service-Component: OSGI-INF/consumer.xml
</code></pre></div><p>Notice that we have also included this header as well:</p> <div class="language- extra-class"><pre class="language-text"><code>...
Service-Component: OSGI-INF/*.xml
...
</code></pre></div><h2 id="v-example-provide-service"><a href="#v-example-provide-service" aria-hidden="true" class="header-anchor">#</a> V. Example - Provide Service</h2> <p>Very often you will have to register a service, that implements an interface defined in the framework (e.g <a href="https://osgi.org/javadoc/r4v42/org/osgi/service/event/EventHandler.html" target="_blank" rel="noopener noreferrer"><em>EventHandler</em><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>) or interface, that you have defined. An interface allows you to change the implementation easily or register multiple implementations in the Service Registry.<br>
We will use DS to register an implementation of the EventHandler service in the OSGi Service Registry.</p> <h3 id="_1-component-description"><a href="#_1-component-description" aria-hidden="true" class="header-anchor">#</a> 1. Component Description</h3> <p>This is how the component description may look like. This file is located in the <em>OSGI-INF</em> folder and is named <em>provider.xml</em>. We are providing some service specific properties as well (the property with name <code>event.topics</code>). The usage of this property is desrcribed in the <a href="https://osgi.org/javadoc/r4v42/org/osgi/service/event/EventConstants.html#EVENT_TOPIC" target="_blank" rel="noopener noreferrer">API documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;scr:component name=&quot;com.example.handler&quot; xmlns:scr=&quot;http://www.osgi.org/xmlns/scr/v1.1.0&quot;&gt;
    &lt;implementation class=&quot;com.example.HandlerImpl&quot;/&gt;
    &lt;property name=&quot;event.topics&quot;&gt;some/topic&lt;/property&gt;
    &lt;service&gt;
        &lt;provide interface=&quot;org.osgi.service.event.EventHandler&quot;/&gt;
    &lt;/service&gt;
&lt;/scr:component&gt;
</code></pre></div><h3 id="_2-implementation-class-2"><a href="#_2-implementation-class-2" aria-hidden="true" class="header-anchor">#</a> 2. Implementation Class</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>provider<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>osgi<span class="token punctuation">.</span>service<span class="token punctuation">.</span>event<span class="token punctuation">.</span>Event<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>osgi<span class="token punctuation">.</span>service<span class="token punctuation">.</span>event<span class="token punctuation">.</span>EventHandler<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>service <span class="token operator">=</span> EventHandler<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> property <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;event.topics=some/topic&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">EventHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleEvent</span><span class="token punctuation">(</span>Event event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String topic <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received event with topic: &quot;</span> <span class="token operator">+</span> topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-service-component-header-2"><a href="#_3-service-component-header-2" aria-hidden="true" class="header-anchor">#</a> 3. Service-Component Header</h3> <div class="language- extra-class"><pre class="language-text"><code>Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: Provider Example
Bundle-SymbolicName: com.example.provider
Bundle-Version: 1.0.0.qualifier
Bundle-RequiredExecutionEnvironment: JavaSE-1.7
Import-Package: org.osgi.service.event
Service-Component: OSGI-INF/provider.xml
</code></pre></div><h2 id="vi-component-types"><a href="#vi-component-types" aria-hidden="true" class="header-anchor">#</a> VI. Component types</h2> <p>A component lifecycle depends of the type of the component. Three type of components are defined:</p> <ul><li><strong>immediate</strong> - with <code>immediate</code> attribute set to <code>true</code> - see the <a href="#service-component-description">example component description</a>;</li> <li><strong>delayed</strong> - with <code>immediate</code> attribute set to <code>false</code>;</li> <li><strong>factory</strong> - we will not discuss the lifecycle of this type in this article. You can find information in the <a href="https://osgi.org/download/r4v42/r4.cmpn.pdf" target="_blank" rel="noopener noreferrer">OSGi 4.2 Compendium Specifiaction, Chapter 112.2.4 Factory Component<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li></ul> <h2 id="vii-component-lifecycle"><a href="#vii-component-lifecycle" aria-hidden="true" class="header-anchor">#</a> VII. Component Lifecycle</h2> <p>A component goes through several states in his lifecycle:</p> <ul><li><strong>UNSATISFIED</strong> - initial state of the Service Component, after the bundle is started;</li> <li><strong>REGISTERED</strong> - temporary state. Only <em>delayed</em> components go through this state;</li> <li><strong>ACTIVE</strong> - the component is active and component instance is created.</li></ul> <img src="/v2.4/a85f255c3cb6b22097fc4e06d17676a9.png" width="320" height="200">  
Fig.1 Immediate component lifecycle
<img src="/v2.4/886839aaadf2442f44f16df032ffe521.png" width="400" height="200">  
Fig.2 Delayed component lifecycle 
<h3 id="_1-states"><a href="#_1-states" aria-hidden="true" class="header-anchor">#</a> 1. States</h3> <p>Like described above, the component lifecycle depends on the lifecycle of the bundle, that includes the component. Component must be enabled before it can be used.</p> <p>A component is <strong>enabled</strong>, when the component's bundle is <strong>started</strong> and <strong>disabled</strong>, when the bundle is <strong>stopped</strong>.</p> <p>After the Component is enabled, it is moved to the UNSATISFIED state. The next step is to satisfy the component configuration.</p> <p>The component <strong>configuration is satisfied</strong> when:</p> <ul><li>component is <strong>enabled</strong>;</li> <li>all the <strong>component references are satisfied</strong>. A reference is satisfied when the reference specifies optional cardinality or there is at least one target service for the reference.
If the component has lazy initialization (the component is <em>delayed</em>), it is moved to the REGISTERED state and it is waiting to be activated, when the service is requested (see Fig.2).<br>
Otherwise (the component is <em>immediate</em>) as soon as its dependencies are satisfied, the component is activated (see Fig.1).</li></ul> <h3 id="_2-activation"><a href="#_2-activation" aria-hidden="true" class="header-anchor">#</a> 2. Activation</h3> <p>Activation consists of following steps:</p> <ul><li>load the implementation class;</li> <li>create component instance;</li> <li>bind target services (<code>bind()</code> method is called);</li> <li>call the <code>activate()</code> method, if present.</li></ul> <p>After the activation, the component is in ACTIVE state. From this state the component can go back to the <em>REGISTERED</em> state (or to the <em>UNSATISFIED</em> state), if the component configuration becomes unsatisfied.</p> <h3 id="_3-deactivation"><a href="#_3-deactivation" aria-hidden="true" class="header-anchor">#</a> 3. Deactivation</h3> <p>Deactivation consists of the following actions:</p> <ul><li>the <code>deactivate</code> method is called, if present;</li> <li>unbind target services (<code>unbind()</code> method is called);</li> <li>release all references to the component instance.</li></ul> <p>For more information - <a href="https://osgi.org/download/r4v42/r4.cmpn.pdf" target="_blank" rel="noopener noreferrer">OSGi 4.2 Compendium Specifiaction, Chapter 112.5 Component Life Cycle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>If you want to practice, what you have learned so far, you can try out our <a href="/v2.4/docs/developer/prerequisites/osgitasks.html">OSGi Coding tasks</a>. In chapter IV. there are tasks, that are using OSGi DS. It is recommended to start from the beginning (chapter I.), as the tasks are related between each other.</p> <h2 id="viii-troubleshooting"><a href="#viii-troubleshooting" aria-hidden="true" class="header-anchor">#</a> VIII. Troubleshooting</h2> <p>If you are new to Declarative Services and you don't know how to troubleshoot, maybe we can help you. We will give you a few tips what might have gone wrong. Some of the steps below depend on your development IDE and the OSGi Container that you use. Mind that most of the tips below are specific to Eclipse IDE and Equinox as the OSGi Runtime. You might review again the <a href="/v2.4/docs/developer/prerequisites/equinox.html#iv-commands">Equinox commands</a> before you continue:</p> <ul><li>make sure that your Component Description (the XML file) contains the necessary information to provide or reference service (see the examples above);</li> <li>make sure that your Component Description is placed in the OSGI-INF folder;</li> <li>[Eclipse IDE only] make sure that no warnings are displayed in the Component Description file (a warning might indicate that some of the class names that you have used are not correct !);</li> <li>open the bundle manifest file (located in META-INF/MANIFEST.MF) and check if your Component Description is added in the &quot;Service-Component&quot; header (it can be added as &quot;OSGI-INF/*.xml or &quot;OSGI-INF/component.xml&quot;);</li> <li>[Eclipse IDE only] open the build.properties file and make sure that the Component Description is added in the bin.includes entry (it can be added as &quot;OSGI-INF/&quot; or &quot;OSGI-INF/component.xml&quot;). If it is not included in the build.properties file, it will not end in the .jar file that will be deployed in the Equinox runtime and SCR will be not able to find it;</li> <li>Start the runtime and check the log. Do you see any Errors like &quot;MESSAGE [SCR] Error while trying to bind reference&quot;? Read the error message and proceed accordingly.</li> <li>Make sure that the bundle that is providing the service is in &quot;ACTIVE&quot; state, if it is not, start it manually with the &quot;start id&quot; command, where id is the id of the bundle;</li> <li>[Equinox only] While the runtime is running type the &quot;services&quot; command and search if your service is registered. In case it is not registered, most probably you have missed some of the steps above 😃;</li> <li>[Equinox only] While the runtime is running type &quot;ls -c id&quot;, where id is the id of the bundle that is providing the service. This will give detailed information about the services that are registered by this bundle, read the information if the component is satisfied carefully;</li> <li>Is your service in use? In case it is not and you are not seeing it registered, the component might have lazy activation policy(this is the default policy). Add &quot;immediate=true&quot; in your Component Definition if you like to change the activation policy.</li></ul> <h2 id="xix-further-reading"><a href="#xix-further-reading" aria-hidden="true" class="header-anchor">#</a> XIX. Further Reading</h2> <ul><li><a href="https://osgi.org/download/r4v42/r4.cmpn.pdf" target="_blank" rel="noopener noreferrer"><em>OSGi Service Platform Service Compendium, Release 4, Version 4.2,
August 2009</em><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.vogella.com/tutorials/OSGiServices/article.html#declarativeservices" target="_blank" rel="noopener noreferrer">Lars Vogel - Declarative services<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.eclipsezone.com/eclipse/forums/t97690.rhtml" target="_blank" rel="noopener noreferrer">Getting Started with OSGi: Declarative Services<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://stackoverflow.com/questions/8886430/what-is-the-difference-between-osgi-components-and-services" target="_blank" rel="noopener noreferrer">http://stackoverflow.com/questions/8886430/what-is-the-difference-between-osgi-components-and-services<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="page-versions"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Version: 2.4</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><a href="https://www.openhab.org/docs/developer/prerequisites/osgids.html">latest</a></li><li class="dropdown-item"><a class="current">2.4</a></li></ul></div></div> <div class="editLink"><em>Caught a mistake or want to contribute to the documentation? <a target="_blank" href="https://github.com/openhab/openhab-docs/edit/master/developers/prerequisites/osgids.md">Edit this page on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></em> <!----></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/v2.4/docs/developer/prerequisites/osgi.html" class="prev">
          OSGi
        </a></span> <span class="next"><a href="/v2.4/docs/developer/prerequisites/configadmin.html">
          Configuration Admin
        </a>
        →
      </span></p></div> <footer><div class="social-icons"><a href="https://twitter.com/openhab" target="_blank"><svg class="social-icon twitter"><path d="M32 7.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path></svg></a> <a href="https://github.com/openhab" target="_blank"><svg class="social-icon github"><path d="M10.369 24.837c0 0.125-0.144 0.225-0.325 0.225-0.206 0.019-0.35-0.081-0.35-0.225 0-0.125 0.144-0.225 0.325-0.225 0.188-0.019 0.35 0.081 0.35 0.225zM8.425 24.556c-0.044 0.125 0.081 0.269 0.269 0.306 0.162 0.063 0.35 0 0.387-0.125s-0.081-0.269-0.269-0.325c-0.162-0.044-0.344 0.019-0.387 0.144zM11.188 24.45c-0.181 0.044-0.306 0.163-0.287 0.306 0.019 0.125 0.181 0.206 0.369 0.163 0.181-0.044 0.306-0.163 0.287-0.288-0.019-0.119-0.188-0.2-0.369-0.181zM15.3 0.5c-8.669 0-15.3 6.581-15.3 15.25 0 6.931 4.362 12.863 10.594 14.95 0.8 0.144 1.081-0.35 1.081-0.756 0-0.387-0.019-2.525-0.019-3.837 0 0-4.375 0.938-5.294-1.863 0 0-0.713-1.819-1.737-2.288 0 0-1.431-0.981 0.1-0.962 0 0 1.556 0.125 2.412 1.613 1.369 2.413 3.662 1.719 4.556 1.306 0.144-1 0.55-1.694 1-2.106-3.494-0.387-7.019-0.894-7.019-6.906 0-1.719 0.475-2.581 1.475-3.681-0.162-0.406-0.694-2.081 0.162-4.244 1.306-0.406 4.313 1.688 4.313 1.688 1.25-0.35 2.594-0.531 3.925-0.531s2.675 0.181 3.925 0.531c0 0 3.006-2.1 4.313-1.688 0.856 2.169 0.325 3.838 0.163 4.244 1 1.106 1.613 1.969 1.613 3.681 0 6.031-3.681 6.512-7.175 6.906 0.575 0.494 1.063 1.431 1.063 2.9 0 2.106-0.019 4.712-0.019 5.225 0 0.406 0.288 0.9 1.081 0.756 6.25-2.075 10.488-8.006 10.488-14.938 0-8.669-7.031-15.25-15.7-15.25zM6.075 22.056c-0.081 0.063-0.063 0.206 0.044 0.325 0.1 0.1 0.244 0.144 0.325 0.063 0.081-0.063 0.063-0.206-0.044-0.325-0.1-0.1-0.244-0.144-0.325-0.063zM5.4 21.55c-0.044 0.081 0.019 0.181 0.144 0.244 0.1 0.063 0.225 0.044 0.269-0.044 0.044-0.081-0.019-0.181-0.144-0.244-0.125-0.038-0.225-0.019-0.269 0.044zM7.425 23.775c-0.1 0.081-0.063 0.269 0.081 0.387 0.144 0.144 0.325 0.163 0.406 0.063 0.081-0.081 0.044-0.269-0.081-0.387-0.138-0.144-0.325-0.163-0.406-0.063zM6.713 22.856c-0.1 0.063-0.1 0.225 0 0.369s0.269 0.206 0.35 0.144c0.1-0.081 0.1-0.244 0-0.387-0.088-0.144-0.25-0.206-0.35-0.125z"></path></svg></a> <a href="https://www.youtube.com/channel/UC7OK88DW0La_BJlcXZg8ydQ" target="_blank"><svg class="social-icon youtube"><path d="M31.681 9.6c0 0-0.313-2.206-1.275-3.175-1.219-1.275-2.581-1.281-3.206-1.356-4.475-0.325-11.194-0.325-11.194-0.325h-0.012c0 0-6.719 0-11.194 0.325-0.625 0.075-1.987 0.081-3.206 1.356-0.963 0.969-1.269 3.175-1.269 3.175s-0.319 2.588-0.319 5.181v2.425c0 2.587 0.319 5.181 0.319 5.181s0.313 2.206 1.269 3.175c1.219 1.275 2.819 1.231 3.531 1.369 2.563 0.244 10.881 0.319 10.881 0.319s6.725-0.012 11.2-0.331c0.625-0.075 1.988-0.081 3.206-1.356 0.962-0.969 1.275-3.175 1.275-3.175s0.319-2.587 0.319-5.181v-2.425c-0.006-2.588-0.325-5.181-0.325-5.181zM12.694 20.15v-8.994l8.644 4.513-8.644 4.481z"></path></svg></a></div> <div class="legal"><span class="copyright">Copyright © 2018 by the openHAB Community and the openHAB Foundation e.V.</span> <br> <span class="legal-links"><a href="/v2.4/privacy.html">Privacy policy</a> |
    <a href="/v2.4/imprint.html">Imprint</a></span></div> <img src="/openhab-logo-square.png" class="footer-logo"></footer></div> <!----></div></div>
    <script src="/v2.4/assets/js/456.09c22ffe.js" defer></script><script src="/v2.4/assets/js/6.b424a272.js" defer></script><script src="/v2.4/assets/js/7.dad7d623.js" defer></script><script src="/v2.4/assets/js/app.1cb1e7e9.js" defer></script>
  </body>
</html>
