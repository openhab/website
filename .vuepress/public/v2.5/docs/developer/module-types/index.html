<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Automation Modules | openHAB</title>
    <meta name="description" content="openHAB - a vendor and technology agnostic open source automation software for your home">
    <link rel="stylesheet" href="/v2.5/fonts/fonts.css">
  <link rel="icon" href="/v2.5/favicon.ico">
  <link rel="shortcut icon" href="/v2.5/favicon.ico">
  <link rel="apple-touch-icon" href="/v2.5/apple-icon.png">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://www.openhab.org/og-image.png">
    <meta property="og:title" content="Automation Modules"><meta property="og:description" content="a vendor and technology agnostic open source automation software for your home">
    <link rel="preload" href="/v2.5/assets/css/0.styles.17119d73.css" as="style"><link rel="preload" href="/v2.5/assets/js/app.6e1f6232.js" as="script"><link rel="preload" href="/v2.5/assets/js/533.f219412f.js" as="script"><link rel="preload" href="/v2.5/assets/js/32.7c8f01a5.js" as="script"><link rel="preload" href="/v2.5/assets/js/33.df59480d.js" as="script">
    <link rel="stylesheet" href="/v2.5/assets/css/0.styles.17119d73.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v2.5/" class="home-link router-link-active"><img src="/v2.5/openhab-logo.png" alt="openHAB" class="logo"> <span class="site-name can-hide">openHAB</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/v2.5/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/v2.5/download/" class="nav-link">Download</a></div><div class="nav-item"><a href="/v2.5/docs/" class="nav-link router-link-active">Documentation</a></div><div class="nav-item"><a href="/v2.5/addons/" class="nav-link">Add-ons</a></div><div class="nav-item"><a href="/v2.5/community/" class="nav-link">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">About</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Get Involved</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/v2.5/about/who-we-are.html" class="nav-link">Who We Are</a></li><li class="dropdown-subitem"><a href="/v2.5/about/contributing.html" class="nav-link">Contribute</a></li><li class="dropdown-subitem"><a href="/v2.5/about/events.html" class="nav-link">Events</a></li></ul></li><li class="dropdown-item"><h4>Support openHAB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://openhabfoundation.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Foundation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/v2.5/about/donate.html" class="nav-link">Donate</a></li></ul></li><li class="dropdown-item"><h4>Resources</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/v2.5/about/showcase.html" class="nav-link">Showcase/How-tos</a></li><li class="dropdown-subitem"><a href="/v2.5/privacy.html" class="nav-link">Privacy Policy</a></li><li class="dropdown-subitem"><a href="https://www.myopenhab.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  myopenHAB
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/openhab" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/v2.5/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="/v2.5/download/" class="nav-link">Download</a></div><div class="nav-item"><a href="/v2.5/docs/" class="nav-link router-link-active">Documentation</a></div><div class="nav-item"><a href="/v2.5/addons/" class="nav-link">Add-ons</a></div><div class="nav-item"><a href="/v2.5/community/" class="nav-link">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">About</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Get Involved</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/v2.5/about/who-we-are.html" class="nav-link">Who We Are</a></li><li class="dropdown-subitem"><a href="/v2.5/about/contributing.html" class="nav-link">Contribute</a></li><li class="dropdown-subitem"><a href="/v2.5/about/events.html" class="nav-link">Events</a></li></ul></li><li class="dropdown-item"><h4>Support openHAB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://openhabfoundation.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Foundation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/v2.5/about/donate.html" class="nav-link">Donate</a></li></ul></li><li class="dropdown-item"><h4>Resources</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/v2.5/about/showcase.html" class="nav-link">Showcase/How-tos</a></li><li class="dropdown-subitem"><a href="/v2.5/privacy.html" class="nav-link">Privacy Policy</a></li><li class="dropdown-subitem"><a href="https://www.myopenhab.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  myopenHAB
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/openhab" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Welcome to openHAB</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.5/docs/" class="sidebar-link">Introduction</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Concepts</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.5/docs/concepts/" class="sidebar-link">Concepts Overview</a></li><li><a href="/v2.5/docs/concepts/things.html" class="sidebar-link">Things</a></li><li><a href="/v2.5/docs/concepts/items.html" class="sidebar-link">Items</a></li><li><a href="/v2.5/docs/concepts/discovery.html" class="sidebar-link">Thing Discovery</a></li><li><a href="/v2.5/docs/concepts/audio.html" class="sidebar-link">Audio &amp; Voice</a></li><li><a href="/v2.5/docs/concepts/units-of-measurement.html" class="sidebar-link">Units Of Measurement</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Installation Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.5/docs/installation/" class="sidebar-link">Installation Overview</a></li><li><a href="/v2.5/docs/installation/linux.html" class="sidebar-link">Linux</a></li><li><a href="/v2.5/docs/installation/windows.html" class="sidebar-link">Windows</a></li><li><a href="/v2.5/docs/installation/macos.html" class="sidebar-link">macOS</a></li><li><a href="/v2.5/docs/installation/openhabian.html" class="sidebar-link">openHABian</a></li><li><a href="/v2.5/docs/installation/rasppi.html" class="sidebar-link">Raspberry Pi</a></li><li><a href="/v2.5/docs/installation/pine.html" class="sidebar-link">PINE A64</a></li><li><a href="/v2.5/docs/installation/docker.html" class="sidebar-link">Docker</a></li><li><a href="/v2.5/docs/installation/synology.html" class="sidebar-link">Synology DiskStation</a></li><li><a href="/v2.5/docs/installation/qnap.html" class="sidebar-link">QNAP NAS</a></li><li><a href="/v2.5/docs/installation/security.html" class="sidebar-link">Security</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>New User Tutorial</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.5/docs/tutorial/" class="sidebar-link">Tutorial Overview</a></li><li><a href="/v2.5/docs/tutorial/1sttimesetup.html" class="sidebar-link">First-time setup of openHAB</a></li><li><a href="/v2.5/docs/tutorial/uis.html" class="sidebar-link">openHAB UIs</a></li><li><a href="/v2.5/docs/tutorial/configuration.html" class="sidebar-link">Configuration of openHAB</a></li><li><a href="/v2.5/docs/tutorial/sitemap.html" class="sidebar-link">Creating a sitemap</a></li><li><a href="/v2.5/docs/tutorial/rules.html" class="sidebar-link">Working with rules and scripts</a></li><li><a href="/v2.5/docs/tutorial/logs.html" class="sidebar-link">Looking to the logs</a></li><li><a href="/v2.5/docs/tutorial/persistence.html" class="sidebar-link">Persistence</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Configuration Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.5/docs/configuration/" class="sidebar-link">Configuration Overview</a></li><li><a href="/v2.5/docs/configuration/addons.html" class="sidebar-link">Installation of Add-ons</a></li><li><a href="/v2.5/docs/configuration/things.html" class="sidebar-link">Things</a></li><li><a href="/v2.5/docs/configuration/items.html" class="sidebar-link">Items</a></li><li><a href="/v2.5/docs/configuration/sitemaps.html" class="sidebar-link">Sitemaps</a></li><li><a href="/v2.5/docs/configuration/persistence.html" class="sidebar-link">Persistence</a></li><li><a href="/v2.5/docs/configuration/rules-dsl.html" class="sidebar-link">Rules</a></li><li><a href="/v2.5/docs/configuration/transformations.html" class="sidebar-link">Transformation Services</a></li><li><a href="/v2.5/docs/configuration/actions.html" class="sidebar-link">Actions</a></li><li><a href="/v2.5/docs/configuration/iconsets/classic/" class="sidebar-link">Icons</a></li><li><a href="/v2.5/docs/configuration/jsr223.html" class="sidebar-link">JSR223 Scripting</a></li><li><a href="/v2.5/docs/configuration/services.html" class="sidebar-link">Services</a></li><li><a href="/v2.5/docs/configuration/multimedia.html" class="sidebar-link">Multimedia</a></li><li><a href="/v2.5/docs/configuration/migration/" class="sidebar-link">Migration from 1.x</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Interfaces and Ecosystem</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.5/docs/configuration/packages.html" class="sidebar-link">Initial Setup - Package Selection</a></li><li><a href="/v2.5/docs/configuration/editors.html" class="sidebar-link">Editors</a></li><li><a href="/v2.5/docs/configuration/homebuilder.html" class="sidebar-link">Home Builder</a></li><li><a href="/v2.5/docs/configuration/paperui.html" class="sidebar-link">Paper UI</a></li><li><a href="/v2.5/docs/configuration/ui/habmin/" class="sidebar-link">HABmin</a></li><li><a href="/v2.5/docs/configuration/ui/habot/" class="sidebar-link">HABot</a></li><li><a href="/v2.5/docs/configuration/habpanel.html" class="sidebar-link">HABPanel</a></li><li><a href="/v2.5/docs/configuration/ui/basic/" class="sidebar-link">Basic UI</a></li><li><a href="/v2.5/docs/configuration/ui/classic/" class="sidebar-link">Classic UI</a></li><li><a href="/v2.5/docs/configuration/rules-ng.html" class="sidebar-link">Next-Gen Rules</a></li><li><a href="/v2.5/docs/configuration/eclipseiotmarket.html" class="sidebar-link">Eclipse IoT Marketplace</a></li><li><a href="/v2.5/docs/configuration/restdocs.html" class="sidebar-link">REST API</a></li><li><a href="/v2.5/docs/apps/android.html" class="sidebar-link">Android App</a></li><li><a href="/v2.5/docs/apps/ios.html" class="sidebar-link">iOS App</a></li><li><a href="/v2.5/docs/apps/windows.html" class="sidebar-link">Windows 10 App</a></li><li><a href="/v2.5/docs/ecosystem/alexa/" class="sidebar-link">Amazon Alexa</a></li><li><a href="/v2.5/docs/ecosystem/google-assistant/" class="sidebar-link">Google Assistant</a></li><li><a href="/v2.5/addons/integrations/homekit/" class="sidebar-link">Apple HomeKit</a></li><li><a href="/v2.5/docs/ecosystem/ifttt/" class="sidebar-link">IFTTT</a></li><li><a href="/v2.5/docs/ecosystem/mycroft/" class="sidebar-link">Mycroft.AI</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Administration Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.5/docs/administration/" class="sidebar-link">Advanced Functionality and Administrative Tasks</a></li><li><a href="/v2.5/docs/administration/console.html" class="sidebar-link">The Console</a></li><li><a href="/v2.5/docs/administration/runtime.html" class="sidebar-link">Runtime Commands</a></li><li><a href="/v2.5/docs/administration/bundles.html" class="sidebar-link">Bundle Management</a></li><li><a href="/v2.5/docs/administration/logging.html" class="sidebar-link">Logging</a></li><li><a href="/v2.5/docs/administration/jsondb.html" class="sidebar-link">JsonDB Storage</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Developer Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.5/docs/developer/" class="sidebar-link">Overview &amp; Introduction </a></li><li><a href="/v2.5/docs/developer/guidelines.html" class="sidebar-link">Coding Guidelines</a></li><li><a href="/v2.5/docs/developer/bindings/" class="sidebar-link">Bindings</a></li><li><a href="/v2.5/docs/developer/module-types/" class="active sidebar-link">Automation Modules</a></li><li><a href="/v2.5/docs/developer/transformations/" class="sidebar-link">Transformations / Profiles</a></li><li><a href="/v2.5/docs/developer/ioservices/" class="sidebar-link">IO Services</a></li><li><a href="/v2.5/docs/developer/persistence/" class="sidebar-link">Persistence Service</a></li><li><a href="/v2.5/docs/developer/audio/" class="sidebar-link">Audio &amp; Voice</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Developer Appendix</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/v2.5/docs/developer/buildsystem.html" class="sidebar-link">Build System</a></li><li><a href="/v2.5/docs/developer/osgi/osgi.html" class="sidebar-link">OSGi</a></li><li><a href="/v2.5/docs/developer/utils/tools.html" class="sidebar-link">Framework Tools</a></li><li><a href="/v2.5/docs/developer/utils/i18n.html" class="sidebar-link">Internationalization</a></li><li><a href="/v2.5/docs/developer/utils/events.html" class="sidebar-link">Event Bus</a></li><li><a href="/v2.5/docs/developer/tests.html" class="sidebar-link">Writing tests</a></li><li><a href="/v2.5/docs/developer/contributing.html" class="sidebar-link">Contribution</a></li><li><a href="/v2.5/docs/developer/governance.html" class="sidebar-link">Governance</a></li><li><a href="/v2.5/docs/developer/legacy/compatibilitylayer.html" class="sidebar-link">Compatibility Layer</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="developing-automation-modules"><a href="#developing-automation-modules" aria-hidden="true" class="header-anchor">#</a> Developing Automation Modules</h1> <p>In this section you will be guided through developing <em>Module Types</em> and corresponding <em>Module Handlers</em> for the automation engine of openHAB.</p> <p></p><div class="table-of-contents"><ul><li><a href="#module-types-and-module-handlers">Module Types and Module Handlers</a></li><li><a href="#module-type-provider">Module Type Provider</a><ul><li><a href="#module-types-via-json">Module types via json</a></li></ul></li><li><a href="#module-handlers">Module Handlers</a><ul><li><a href="#trigger-handler">Trigger Handler</a></li><li><a href="#condition-handler">Condition Handler</a></li><li><a href="#action-handler">Action Handler</a></li></ul></li><li><a href="#tie-everything-together-define-rules">Tie everything together: Define rules</a><ul><li><a href="#via-json-files">Via json files</a></li><li><a href="#programmatically-define-rules">Programmatically define rules</a></li><li><a href="#define-constant-non-changable-rules">Define constant / non-changable rules</a></li></ul></li><li><a href="#further-reading">Further reading</a></li></ul></div><p></p> <h2 id="module-types-and-module-handlers"><a href="#module-types-and-module-handlers" aria-hidden="true" class="header-anchor">#</a> Module Types and Module Handlers</h2> <p>Module Types describe Conditions, Triggers and Actions for the automation engine in terms of user visible strings like a label, a description, tags.
But also what configuration values are available and what inputs and outputs a Module Type provides.</p> <p>For each <em>Module Type</em> a corresponding <em>Module Handler</em> is in place to actually execute code.</p> <p>To better get into the topic, let's develop a rule for the automation engine that is compromised completely out of custom modules (in contrast to core provided ones).</p> <p>In our hands-on application we will switch on a virtual air conditioner (<code>Action</code>) as soon as the outdoor temperature is over a certain value (<code>Trigger</code>), but only if a person is at home (<code>Condition</code>).
We want the air conditioner to operate at different levels depending on the temperature.</p> <p>First you want to create a new bundle for example via the skeleton.</p> <h2 id="module-type-provider"><a href="#module-type-provider" aria-hidden="true" class="header-anchor">#</a> Module Type Provider</h2> <p>To inform the rule engine of your module types, you implement an OSGi service that extends <code>ModuleTypeProvider</code>.
As soon as this provider is active, you have access to all the exposed triggers, conditions and actions from
within old xtend rules, scripts and automation engine rules.</p> <p>Just keep in mind, that this only describes your triggers, conditions and actions,
but the automation engine will not yet know what to do when encountering such a module.
We implement the handlers in a follow up section.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@NonNullByDefault</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>immediately<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">,</span> service<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">ModuleTypeProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyModuleTypeProvider</span> <span class="token keyword">implements</span> <span class="token class-name">ModuleTypeProvider</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ModuleType</span><span class="token punctuation">&gt;</span></span> providedModuleTypes<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyModuleTypeProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        providedModuleTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ModuleType</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        providedModuleTypes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">TemperatureTriggerType</span><span class="token punctuation">.</span>UID<span class="token punctuation">,</span> <span class="token class-name">TemperatureTriggerType</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        providedModuleTypes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">PresenceConditionType</span><span class="token punctuation">.</span>UID<span class="token punctuation">,</span> <span class="token class-name">PresenceConditionType</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        providedModuleTypes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">AirConditionerActionType</span><span class="token punctuation">.</span>UID<span class="token punctuation">,</span> <span class="token class-name">AirConditionerActionType</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">ModuleType</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getModuleType</span><span class="token punctuation">(</span><span class="token class-name">String</span> UID<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> providedModuleTypes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>UID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">ModuleType</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getModuleTypes</span><span class="token punctuation">(</span><span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> providedModuleTypes<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addProviderChangeListener</span><span class="token punctuation">(</span><span class="token class-name">ProviderChangeListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ModuleType</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// does nothing because this provider does not change</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ModuleType</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableCollection</span><span class="token punctuation">(</span>providedModuleTypes<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeProviderChangeListener</span><span class="token punctuation">(</span><span class="token class-name">ProviderChangeListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ModuleType</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// does nothing because this provider does not change</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The above factory is exposing all three <em>Module Types</em> that we need for our scenario.
We do not need to care about the <code>ProviderChangeListener</code> methods here, because our types are rather static.
If module types change over time in your factory, you need to notify the automation engine.</p> <p>It is common practise to define the unique ID (UID) within the type class itself.</p> <p>Let's have a look at all of our type classes:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@NonNullByDefault</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemperatureTriggerType</span> <span class="token keyword">extends</span> <span class="token class-name">TriggerType</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> UID <span class="token operator">=</span> <span class="token string">&quot;TemperatureTriggerType&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> DATA_CURRENT_TEMPERATURE <span class="token operator">=</span> <span class="token string">&quot;temperature&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CONFIG_OPERATOR <span class="token operator">=</span> <span class="token string">&quot;operator&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CONFIG_TEMPERATURE <span class="token operator">=</span> <span class="token string">&quot;temperature&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">TriggerType</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Factory method Pattern</span>
        <span class="token comment">// Define outputs</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Output</span><span class="token punctuation">&gt;</span></span> output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Output</span> temperature <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span>DATA_CURRENT_TEMPERATURE<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Temperature&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Indicates the current room temperature&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        output<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Define configurations</span>
        <span class="token keyword">final</span> <span class="token class-name">ConfigDescriptionParameter</span> temperature <span class="token operator">=</span> <span class="token class-name">ConfigDescriptionParameterBuilder</span>
                <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>CONFIG_TEMPERATURE<span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INTEGER<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMultiple</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withLabel</span><span class="token punctuation">(</span><span class="token string">&quot;Temperature&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span><span class="token string">&quot;Trigger temperature&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ConfigDescriptionParameter</span> operator <span class="token operator">=</span> <span class="token class-name">ConfigDescriptionParameterBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>CONFIG_OPERATOR<span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>TEXT<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMultiple</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withLabel</span><span class="token punctuation">(</span><span class="token string">&quot;Operator&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span><span class="token string">&quot;Below/Above temperature&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDefault</span><span class="token punctuation">(</span><span class="token string">&quot;above&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigDescriptionParameter</span><span class="token punctuation">&gt;</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>operator<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AirConditionerTriggerType</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">AirConditionerTriggerType</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Output</span><span class="token punctuation">&gt;</span></span> output<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigDescriptionParameter</span><span class="token punctuation">&gt;</span></span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>UID<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token string">&quot;Temperature Trigger&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;This triggers when the temperature has reached a certain value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">Visibility</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As you can see the constructor of the extended <code>TriggerType</code> expects us to fill in a label and description text and lets us define if the trigger is for public use (<code>VISIBLE</code>).</p> <p>Configuration parameters are described to the user and to user-interfaces via <code>ConfigDescriptionParameter</code>s.
A configuration parameter needs a unique ID, a label, optionally a description and a type (TEXT, INTEGER, BOOLEAN and so on).</p> <p>Triggers and Conditions can also output data.
And our temperature trigger will not only trigger on a configured temperature, but also output it.</p> <p>To define an <em>Output</em> you need to pass at least an ID, a type, a label and a description to the constructor.
The type is the fully qualified name of a class, in this case from the <code>Integer</code> class.</p> <p>Conditions and Actions can take inputs on the other hand.</p> <p>Speaking of which, let's have a look at the code.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PresenceConditionType</span> <span class="token keyword">extends</span> <span class="token class-name">ConditionType</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> UID <span class="token operator">=</span> <span class="token string">&quot;PresenceConditionType&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> DATA_PRESENCE <span class="token operator">=</span> <span class="token string">&quot;presence&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CONFIG_PRESENCE_ITEM <span class="token operator">=</span> <span class="token string">&quot;presence&quot;</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConditionType</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigDescriptionParameter</span><span class="token punctuation">&gt;</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">ConfigDescriptionParameter</span> presenceItemConfig<span class="token punctuation">;</span>
      presenceItemConfig <span class="token operator">=</span> <span class="token class-name">ConfigDescriptionParameterBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>CONFIG_PRESENCE_ITEM<span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>TEXT<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">withRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMultiple</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withLabel</span><span class="token punctuation">(</span><span class="token string">&quot;Presence item&quot;</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span><span class="token string">&quot;The item that decides if this condition is satisfied&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      config<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>presenceItemConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span><span class="token punctuation">&gt;</span></span> input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Output</span><span class="token punctuation">&gt;</span></span> output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Output</span> state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Output</span><span class="token punctuation">(</span>DATA_PRESENCE<span class="token punctuation">,</span> <span class="token string">&quot;State&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Presence&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;Indicates the state of the presence detector via an ON or OFF&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      output<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PresenceConditionType</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> input<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token class-name">PresenceConditionType</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigDescriptionParameter</span><span class="token punctuation">&gt;</span></span> config<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span><span class="token punctuation">&gt;</span></span> input<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span><span class="token punctuation">&gt;</span></span> output<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span>UID<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token string">&quot;Presence Condition&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;This condition is satisfied when the configure presence item is in ON state&quot;</span><span class="token punctuation">,</span> output<span class="token punctuation">,</span> <span class="token class-name">Visibility</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The Condition that we are going to implement in the Condition Handler latter on will use the state of an item to decide if this presence condition is satisfied.</p> <p>Notice that our output is of type &quot;State&quot; instead of a fully qualified class name like <code>java.lang.String</code>.
The following openHAB classes have short forms:</p> <ul><li>&quot;State&quot; (an <em>Item</em> state)</li> <li>&quot;Event&quot; (an openHAB event from the event bus)</li> <li>&quot;Command&quot; (a command targeting an <em>Item</em>)</li></ul> <p>And now let's have a look at the Action type.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AirConditionerActionType</span> <span class="token keyword">extends</span> <span class="token class-name">ActionType</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> UID <span class="token operator">=</span> <span class="token string">&quot;AirConditionerActionType&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CONFIG_LEVEL1_MIN_TEMP <span class="token operator">=</span> <span class="token string">&quot;level1_min_temp&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CONFIG_LEVEL2_MIN_TEMP <span class="token operator">=</span> <span class="token string">&quot;level2_min_temp&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ActionType</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">ConfigDescriptionParameter</span> temp1 <span class="token operator">=</span> <span class="token class-name">ConfigDescriptionParameterBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>CONFIG_LEVEL1_MIN_TEMP<span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INTEGER<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMultiple</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withLabel</span><span class="token punctuation">(</span><span class="token string">&quot;Temperature for level 1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span><span class="token string">&quot;Level 1 on the given temperature in celsius&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ConfigDescriptionParameter</span> temp2 <span class="token operator">=</span> <span class="token class-name">ConfigDescriptionParameterBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>CONFIG_LEVEL2_MIN_TEMP<span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>INTEGER<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMultiple</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withLabel</span><span class="token punctuation">(</span><span class="token string">&quot;Temperature for level 2&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span><span class="token string">&quot;Level 2 on the given temperature in celsius&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigDescriptionParameter</span><span class="token punctuation">&gt;</span></span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigDescriptionParameter</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>temp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>temp2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Input</span> currentTemperature <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Input</span><span class="token punctuation">(</span><span class="token class-name">TemperatureTriggerType</span><span class="token punctuation">.</span>DATA_CURRENT_TEMPERATURE<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Current Temperature&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Depending on this temperature input the AC will turn on&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span><span class="token punctuation">&gt;</span></span> input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        input<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>currentTemperature<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AirConditionerActionType</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">AirConditionerActionType</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigDescriptionParameter</span><span class="token punctuation">&gt;</span></span> config<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span><span class="token punctuation">&gt;</span></span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>UID<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token string">&quot;Switch an air conditioner&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Control an air conditioner. Depending on the configuration and inputs it is switched into different power levels.&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                <span class="token class-name">Visibility</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">,</span> input<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Our Action is quite simple.
Our air conditioner is turned off by default, is going into power level 1 when a certain temperature is reached and into level 2 on a second configured temperature.</p> <p>It is the task of a rule to wire outputs to inputs.
In our module types we just have to make sure that output and input types are matching.
In this action for example we have an input of type <code>TemperatureTriggerType.DATA_CURRENT_TEMPERATURE</code> which is exactly the output of our trigger module type.</p> <p>The programmatic way is useful for dynamically appearing module types.
You will learn an easier way in a moment for statically defined module types</p> <h3 id="module-types-via-json"><a href="#module-types-via-json" aria-hidden="true" class="header-anchor">#</a> Module types via json</h3> <p>In the last section we learned about the programmatic way of exposing <em>Module Types</em>.
It is actually way easier to just descripe your module types in a declarative way via json and bundle them with your addon.</p> <p>To describe your modules (triggers, conditions, actions), add json files to <code>src/main/resources/ESH-INF/automation/moduletypes/</code>.
A module type file can contain one or multiple type descriptions.</p> <p>For our scenario we go with one file:</p> <div class="language-json extra-class"><pre class="language-dsl"><code><span class="token punctuation">{</span>  
   <span class="token string">&quot;triggers&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>  
         <span class="token string">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;TemperatureTriggerType&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Temperature Trigger&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;This triggers when the temperature has reached a certain value&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;configDescriptions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>  
            <span class="token punctuation">{</span>  
               <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;INTEGER&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Temperature&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Trigger temperature&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;required&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>  
               <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;operator&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;TEXT&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Operator&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Below/Above temperature&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;required&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
               <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;above&quot;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string">&quot;outputs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>  
            <span class="token punctuation">{</span>  
               <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;java.lang.Integer&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Current Temperature&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Indicates the current room temperature&quot;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token string">&quot;conditions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>  
      <span class="token punctuation">{</span>  
         <span class="token string">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;PresenceConditionType&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Presence Condition&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;This condition is satisfied when the configure presence item is in ON state&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;configDescriptions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>  
            <span class="token punctuation">{</span>  
               <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;presence&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;TEXT&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Presence item&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;The item that decides if this condition is satisfied&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;required&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string">&quot;outputs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>  
            <span class="token punctuation">{</span>  
               <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;presence&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;State&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Output value&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Indicates the state of the presence detector via an ON or OFF&quot;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token string">&quot;actions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>  
      <span class="token punctuation">{</span>  
         <span class="token string">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;AirConditionerActionType&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Switch an air conditioner&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Control an air conditioner. Depending on the configuration and inputs it is switched into different power levels&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;configDescriptions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>  
            <span class="token punctuation">{</span>  
               <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;level1_min_temp&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;INTEGER&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Temperature for level 1&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Level 1 on the given temperature in celsius&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;required&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>  
               <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;level2_min_temp&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;INTEGER&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Temperature for level 2&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Level 2 on the given temperature in celsius&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;required&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string">&quot;inputs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>  
            <span class="token punctuation">{</span>  
               <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;java.lang.Integer&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Current Temperature&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Depending on this temperature input the AC will turn on&quot;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="module-handlers"><a href="#module-handlers" aria-hidden="true" class="header-anchor">#</a> Module Handlers</h2> <p>You now have semantically described your modules.</p> <p>The pieces of code that actually</p> <ul><li>trigger, in case of Trigger types,</li> <li>decide on condition satisfaction for Condition types or</li> <li>execute something in case of Action types</li></ul> <p>are called <em>Module handlers</em>.</p> <p>We now go over the implementation for all of our custom modules.</p> <p>As usual, we need a factory that creates module handlers on demand for the automation engine:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@NonNullByDefault</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>service<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">ModuleHandlerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHandlerFactory</span> <span class="token keyword">extends</span> <span class="token class-name">BaseModuleHandlerFactory</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> MODULE_HANDLER_FACTORY_NAME <span class="token operator">=</span> <span class="token string">&quot;[MyHandlerFactory]&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> TYPES<span class="token punctuation">;</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">MyHandlerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Reference</span>
   <span class="token keyword">private</span> <span class="token annotation punctuation">@NonNullByDefault</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token class-name">ItemRegistry</span> itemRegistry<span class="token punctuation">;</span>

   <span class="token keyword">static</span> <span class="token punctuation">{</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> temp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      temp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">TemperatureTriggerType</span><span class="token punctuation">.</span>UID<span class="token punctuation">)</span><span class="token punctuation">;</span>
      temp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">PresenceConditionType</span><span class="token punctuation">.</span>UID<span class="token punctuation">)</span><span class="token punctuation">;</span>
      temp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">AirConditionerActionType</span><span class="token punctuation">.</span>UID<span class="token punctuation">)</span><span class="token punctuation">;</span>
      TYPES <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableCollection</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Tell the automation engine about our handlers</span>
   <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> TYPES<span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">protected</span> <span class="token class-name">ModuleHandler</span> <span class="token function">internalCreate</span><span class="token punctuation">(</span><span class="token class-name">Module</span> <span class="token keyword">module</span><span class="token punctuation">,</span> <span class="token class-name">String</span> ruleUID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">ModuleHandler</span> moduleHandler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TemperatureTriggerType</span><span class="token punctuation">.</span>UID<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">getTypeUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         moduleHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemperatureTriggerHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Action</span><span class="token punctuation">)</span> <span class="token keyword">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">PresenceConditionType</span><span class="token punctuation">.</span>UID<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">getTypeUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         moduleHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PresenceConditionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Condition</span><span class="token punctuation">)</span> <span class="token keyword">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">AirConditionerActionType</span><span class="token punctuation">.</span>UID<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">getTypeUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         moduleHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AirConditionerActionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Condition</span><span class="token punctuation">)</span> <span class="token keyword">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>MODULE_HANDLER_FACTORY_NAME <span class="token operator">+</span> <span class="token string">&quot;Not supported moduleHandler: {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">getTypeUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> moduleHandler<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the next three sections we'll implement those three handlers.</p> <h3 id="trigger-handler"><a href="#trigger-handler" aria-hidden="true" class="header-anchor">#</a> Trigger Handler</h3> <p>A <em>Trigger Handler</em> is created by the automation engine for each trigger module type in actual rules,
via the factory that we have implemented above.</p> <p>The handler tells the rule engine that something happened.
In our example scenario that is when the temperature of an imaginary external device has reached a specific value.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TemperatureTriggerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTriggerModuleHandler</span>
  <span class="token keyword">implements</span> <span class="token class-name">ExternalDeviceTempChangeListener</span> <span class="token comment">// We are listening to imaginary temp change events</span>
<span class="token punctuation">{</span>
   <span class="token keyword">final</span> <span class="token keyword">double</span> temperature<span class="token punctuation">;</span>
   <span class="token keyword">final</span> <span class="token keyword">boolean</span> onAbove<span class="token punctuation">;</span>
   <span class="token comment">// Evaluate your configuration in the constructor</span>
   <span class="token keyword">public</span> <span class="token class-name">TemperatureTriggerHandler</span><span class="token punctuation">(</span><span class="token class-name">Trigger</span> <span class="token keyword">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Number</span> tempNumber <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">TemperatureTriggerType</span><span class="token punctuation">.</span>CONFIG_TEMPERATURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
      temperature <span class="token operator">=</span> <span class="token punctuation">(</span>tempNumber<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> tempNumber<span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">20.0</span><span class="token punctuation">;</span>

      <span class="token class-name">String</span> tempOp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">TemperatureTriggerType</span><span class="token punctuation">.</span>CONFIG_OPERATOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
      onAbove <span class="token operator">=</span> <span class="token punctuation">(</span>tempOp <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;below&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>tempOp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      
   <span class="token punctuation">}</span>

   <span class="token comment">// Setup your triggering stuff in here</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRuleEngineCallback</span><span class="token punctuation">(</span><span class="token class-name">RuleEngineCallback</span> ruleCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setRuleEngineCallback</span><span class="token punctuation">(</span>ruleCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Register to temp change events on our imaginary external device</span>
      <span class="token class-name">ExternalTemperatureDevice</span><span class="token punctuation">.</span><span class="token function">registerTemperatureChangeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Do your clean up here</span>
      <span class="token class-name">ExternalTemperatureDevice</span><span class="token punctuation">.</span><span class="token function">unregisterTemperatureChangeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Event from our imaginary temperature device. Triggers connected rules if temp is</span>
   <span class="token comment">// over the configured threshold.</span>
   <span class="token annotation punctuation">@Override</span> 
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">tempChangedOnImaginaryDevice</span><span class="token punctuation">(</span><span class="token keyword">int</span> tempInCelsius<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token punctuation">(</span>tempInCelsius<span class="token operator">&gt;</span>temperature <span class="token operator">&amp;&amp;</span> onAbove<span class="token punctuation">)</span> <span class="token operator">||</span>
            <span class="token punctuation">(</span>tempInCelsius<span class="token operator">&lt;</span>temperature <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>onAbove<span class="token punctuation">)</span>
         <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TriggerHandlerCallback</span><span class="token punctuation">)</span> callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">triggered</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="condition-handler"><a href="#condition-handler" aria-hidden="true" class="header-anchor">#</a> Condition Handler</h3> <p>Condition Handler serves to help the Automation Engine to decide if it continues with the execution of the rule or to terminate it.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PresenceConditionHandler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseModuleHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Condition</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">ConditionHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">ItemRegistry</span> itemRegistry<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">PresenceConditionHandler</span><span class="token punctuation">(</span><span class="token class-name">Condition</span> <span class="token keyword">module</span><span class="token punctuation">,</span> <span class="token class-name">ItemRegistry</span> itemRegistry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>itemRegistry <span class="token operator">=</span> itemRegistry<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSatisfied</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Number</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">TemperatureConditionType</span><span class="token punctuation">.</span>INPUT_CURRENT_TEMPERATURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Number</span> right <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">TemperatureConditionType</span><span class="token punctuation">.</span>CONFIG_TEMPERATURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> operator <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">TemperatureConditionType</span><span class="token punctuation">.</span>CONFIG_OPERATOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TemperatureConditionType</span><span class="token punctuation">.</span>OPERATOR_HEATING<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> right <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> left<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> right<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TemperatureConditionType</span><span class="token punctuation">.</span>OPERATOR_COOLING<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> right <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> left<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> right<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="action-handler"><a href="#action-handler" aria-hidden="true" class="header-anchor">#</a> Action Handler</h3> <p>Action Handler is used to help the Automation Engine to execute the specific Actions.
A simple implementation of it can be seen into <code>WelcomeHomeActionHandler</code> class.</p> <h2 id="tie-everything-together-define-rules"><a href="#tie-everything-together-define-rules" aria-hidden="true" class="header-anchor">#</a> Tie everything together: Define rules</h2> <p>Until now we have taught the automation engine a way to trigger on specific temperatures,
to tell us if someone is at home,
and to switch on an air conditioner at different levels.</p> <p>We now need to write an actual rule to use our custom modules.</p> <h3 id="via-json-files"><a href="#via-json-files" aria-hidden="true" class="header-anchor">#</a> Via json files</h3> <p>The automation engine reads rule json files from the <code>{openhab-dir}/automation/*.json</code> directory.</p> <p>The rule that implements our application is declaratively described in the json format like this:</p> <div class="language-json extra-class"><pre class="language-dsl"><code><span class="token punctuation">[</span>  
   <span class="token punctuation">{</span>  
      <span class="token string">&quot;uid&quot;</span><span class="token operator">:</span><span class="token string">&quot;JsonDemoRule&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;DemoRule&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;triggers&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token punctuation">{</span>  
            <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;RuleTrigger&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Item State Change Trigger&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;This triggers a rule if an items state changed&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;ItemStateChangeTrigger&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;configuration&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>  
               <span class="token string">&quot;itemName&quot;</span><span class="token operator">:</span><span class="token string">&quot;DemoSwitch&quot;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">&quot;conditions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">&quot;actions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token punctuation">{</span>  
            <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;RuleAction&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;label&quot;</span><span class="token operator">:</span><span class="token string">&quot;Post command to an item&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;Posts commands on items&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;ItemPostCommandAction&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;configuration&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>  
               <span class="token string">&quot;itemName&quot;</span><span class="token operator">:</span><span class="token string">&quot;DemoDimmer&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;command&quot;</span><span class="token operator">:</span><span class="token string">&quot;ON&quot;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="programmatically-define-rules"><a href="#programmatically-define-rules" aria-hidden="true" class="header-anchor">#</a> Programmatically define rules</h3> <p>You can also define rules programmatically and add them to the <code>RuleRegistry</code>.
Rules defined and added to the registry like this can be changed via user-interfaces.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@NonNullByDefault</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>immediately<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRuleRegistrationComponent</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Reference</span>
    <span class="token keyword">protected</span> <span class="token annotation punctuation">@NonNullByDefault</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token class-name">RuleRegistry</span> ruleRegistry<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Activated</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">activated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ruleRegistry<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">createACRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Rule</span> <span class="token function">createACRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// initialize the trigger</span>
        <span class="token class-name">String</span> triggerId <span class="token operator">=</span> <span class="token string">&quot;LightsSwitchOnRuleTrigger&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Trigger</span><span class="token punctuation">&gt;</span></span> triggers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Trigger</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        triggers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Trigger</span><span class="token punctuation">(</span>triggerId<span class="token punctuation">,</span> <span class="token class-name">LightsTriggerType</span><span class="token punctuation">.</span>UID<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// initialize the condition - here the tricky part is the referring into the condition input - trigger output.</span>
        <span class="token comment">// The syntax is a similar to the JUEL syntax.</span>
        <span class="token class-name">Configuration</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">StateConditionType</span><span class="token punctuation">.</span>CONFIG_STATE<span class="token punctuation">,</span> <span class="token string">&quot;on&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Condition</span><span class="token punctuation">&gt;</span></span> conditions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Condition</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> inputs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inputs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">StateConditionType</span><span class="token punctuation">.</span>INPUT_CURRENT_STATE<span class="token punctuation">,</span> triggerId <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> <span class="token class-name">StateConditionType</span><span class="token punctuation">.</span>INPUT_CURRENT_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        conditions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Condition</span><span class="token punctuation">(</span><span class="token string">&quot;LightsStateCondition&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StateConditionType</span><span class="token punctuation">.</span>UID<span class="token punctuation">,</span> config<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// initialize the action - here the tricky part is the referring into the action configuration parameter - the</span>
        <span class="token comment">// template configuration parameter. The syntax is a similar to the JUEL syntax.</span>
        config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WelcomeHomeActionType</span><span class="token punctuation">.</span>CONFIG_DEVICE<span class="token punctuation">,</span> <span class="token string">&quot;Lights&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WelcomeHomeActionType</span><span class="token punctuation">.</span>CONFIG_RESULT<span class="token punctuation">,</span> <span class="token string">&quot;Lights are switched on&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Action</span><span class="token punctuation">&gt;</span></span> actions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Action</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        actions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Action</span><span class="token punctuation">(</span><span class="token string">&quot;LightsSwitchOnAction&quot;</span><span class="token punctuation">,</span> <span class="token class-name">WelcomeHomeActionType</span><span class="token punctuation">.</span>UID<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// initialize the configDescriptions</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigDescriptionParameter</span><span class="token punctuation">&gt;</span></span> configDescriptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigDescriptionParameter</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ConfigDescriptionParameter</span> device <span class="token operator">=</span> <span class="token class-name">ConfigDescriptionParameterBuilder</span>
                <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">WelcomeHomeRulesProvider</span><span class="token punctuation">.</span>CONFIG_UNIT<span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>TEXT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withMultiple</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withLabel</span><span class="token punctuation">(</span><span class="token string">&quot;Device&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span><span class="token string">&quot;Device description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ConfigDescriptionParameter</span> result <span class="token operator">=</span> <span class="token class-name">ConfigDescriptionParameterBuilder</span>
                <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">WelcomeHomeRulesProvider</span><span class="token punctuation">.</span>CONFIG_EXPECTED_RESULT<span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>TEXT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMultiple</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withLabel</span><span class="token punctuation">(</span><span class="token string">&quot;Result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span><span class="token string">&quot;Result description&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configDescriptions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">;</span>
        configDescriptions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// initialize the configuration</span>
        config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>CONFIG_UNIT<span class="token punctuation">,</span> <span class="token string">&quot;Lights&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>CONFIG_EXPECTED_RESULT<span class="token punctuation">,</span> <span class="token string">&quot;The lights are switched on.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create the rule</span>
        <span class="token class-name">Rule</span> lightsSwitchOn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rule</span><span class="token punctuation">(</span>L_UID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        lightsSwitchOn<span class="token punctuation">.</span><span class="token function">setTriggers</span><span class="token punctuation">(</span>triggers<span class="token punctuation">)</span><span class="token punctuation">;</span>
        lightsSwitchOn<span class="token punctuation">.</span><span class="token function">setConfigurationDescriptions</span><span class="token punctuation">(</span>configDescriptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        lightsSwitchOn<span class="token punctuation">.</span><span class="token function">setConditions</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        lightsSwitchOn<span class="token punctuation">.</span><span class="token function">setActions</span><span class="token punctuation">(</span>actions<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// initialize the tags</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tags<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;lights&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set the tags</span>
        lightsSwitchOn<span class="token punctuation">.</span><span class="token function">setTags</span><span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> lightsSwitchOn<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="define-constant-non-changable-rules"><a href="#define-constant-non-changable-rules" aria-hidden="true" class="header-anchor">#</a> Define constant / non-changable rules</h3> <p>We have seen how to define rules via json files as well as programatically.
A third way is to inject rules via an own <code>RuleProvider</code>.</p> <p>Those rules are compiled into the bundle and cannot be changed later on, which might be desired.
We will use the <code>createACRule</code> method from above.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@NonNullByDefault</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>immediately<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">,</span> service<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">RuleProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyStaticRulesProvider</span> <span class="token keyword">implements</span> <span class="token class-name">RuleProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProviderChangeListener</span><span class="token punctuation">&lt;</span><span class="token class-name">Rule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> listeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">&quot;AirConditionerSwitchOnRule&quot;</span><span class="token punctuation">,</span> <span class="token function">createACRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addProviderChangeListener</span><span class="token punctuation">(</span><span class="token class-name">ProviderChangeListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span> listeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> rules<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeProviderChangeListener</span><span class="token punctuation">(</span><span class="token class-name">ProviderChangeListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span> listeners<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="further-reading"><a href="#further-reading" aria-hidden="true" class="header-anchor">#</a> Further reading</h2> <p>This document does not yet cover all features of the automation engine.</p> <p>We skipped rule templates and did not cover existing module types for common tasks,
like triggering on an item state change or post a command as an action.</p> <p>Please discover existing module types on your own from within the user interfaces
and by consulting our user documentation.</p> <p>For rule templates you may just ask in our friendly community or extend this document.</p> <div class="page-versions"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Version: 2.5</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><a href="https://www.openhab.org/docs/developer/module-types/">latest</a></li><li class="dropdown-item"><a class="current">2.5</a></li></ul></div></div> <div class="editLink"><em>Caught a mistake or want to contribute to the documentation? <a target="_blank" href="https://github.com/openhab/openhab-docs/edit/master/developers/module-types/index.md">Edit this page on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></em> <!----></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        
        <a href="/v2.5/docs/developer/bindings/" class="prev">
          Bindings
        </a></span> <span class="next"><a href="/v2.5/docs/developer/transformations/">
          Transformations / Profiles
        </a>
        
      </span></p></div> <footer><div class="social-icons"><a href="https://twitter.com/openhab" target="_blank"><svg class="social-icon twitter"><path d="M32 7.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path></svg></a> <a href="https://github.com/openhab" target="_blank"><svg class="social-icon github"><path d="M10.369 24.837c0 0.125-0.144 0.225-0.325 0.225-0.206 0.019-0.35-0.081-0.35-0.225 0-0.125 0.144-0.225 0.325-0.225 0.188-0.019 0.35 0.081 0.35 0.225zM8.425 24.556c-0.044 0.125 0.081 0.269 0.269 0.306 0.162 0.063 0.35 0 0.387-0.125s-0.081-0.269-0.269-0.325c-0.162-0.044-0.344 0.019-0.387 0.144zM11.188 24.45c-0.181 0.044-0.306 0.163-0.287 0.306 0.019 0.125 0.181 0.206 0.369 0.163 0.181-0.044 0.306-0.163 0.287-0.288-0.019-0.119-0.188-0.2-0.369-0.181zM15.3 0.5c-8.669 0-15.3 6.581-15.3 15.25 0 6.931 4.362 12.863 10.594 14.95 0.8 0.144 1.081-0.35 1.081-0.756 0-0.387-0.019-2.525-0.019-3.837 0 0-4.375 0.938-5.294-1.863 0 0-0.713-1.819-1.737-2.288 0 0-1.431-0.981 0.1-0.962 0 0 1.556 0.125 2.412 1.613 1.369 2.413 3.662 1.719 4.556 1.306 0.144-1 0.55-1.694 1-2.106-3.494-0.387-7.019-0.894-7.019-6.906 0-1.719 0.475-2.581 1.475-3.681-0.162-0.406-0.694-2.081 0.162-4.244 1.306-0.406 4.313 1.688 4.313 1.688 1.25-0.35 2.594-0.531 3.925-0.531s2.675 0.181 3.925 0.531c0 0 3.006-2.1 4.313-1.688 0.856 2.169 0.325 3.838 0.163 4.244 1 1.106 1.613 1.969 1.613 3.681 0 6.031-3.681 6.512-7.175 6.906 0.575 0.494 1.063 1.431 1.063 2.9 0 2.106-0.019 4.712-0.019 5.225 0 0.406 0.288 0.9 1.081 0.756 6.25-2.075 10.488-8.006 10.488-14.938 0-8.669-7.031-15.25-15.7-15.25zM6.075 22.056c-0.081 0.063-0.063 0.206 0.044 0.325 0.1 0.1 0.244 0.144 0.325 0.063 0.081-0.063 0.063-0.206-0.044-0.325-0.1-0.1-0.244-0.144-0.325-0.063zM5.4 21.55c-0.044 0.081 0.019 0.181 0.144 0.244 0.1 0.063 0.225 0.044 0.269-0.044 0.044-0.081-0.019-0.181-0.144-0.244-0.125-0.038-0.225-0.019-0.269 0.044zM7.425 23.775c-0.1 0.081-0.063 0.269 0.081 0.387 0.144 0.144 0.325 0.163 0.406 0.063 0.081-0.081 0.044-0.269-0.081-0.387-0.138-0.144-0.325-0.163-0.406-0.063zM6.713 22.856c-0.1 0.063-0.1 0.225 0 0.369s0.269 0.206 0.35 0.144c0.1-0.081 0.1-0.244 0-0.387-0.088-0.144-0.25-0.206-0.35-0.125z"></path></svg></a> <a href="https://www.youtube.com/channel/UC7OK88DW0La_BJlcXZg8ydQ" target="_blank"><svg class="social-icon youtube"><path d="M31.681 9.6c0 0-0.313-2.206-1.275-3.175-1.219-1.275-2.581-1.281-3.206-1.356-4.475-0.325-11.194-0.325-11.194-0.325h-0.012c0 0-6.719 0-11.194 0.325-0.625 0.075-1.987 0.081-3.206 1.356-0.963 0.969-1.269 3.175-1.269 3.175s-0.319 2.588-0.319 5.181v2.425c0 2.587 0.319 5.181 0.319 5.181s0.313 2.206 1.269 3.175c1.219 1.275 2.819 1.231 3.531 1.369 2.563 0.244 10.881 0.319 10.881 0.319s6.725-0.012 11.2-0.331c0.625-0.075 1.988-0.081 3.206-1.356 0.962-0.969 1.275-3.175 1.275-3.175s0.319-2.587 0.319-5.181v-2.425c-0.006-2.588-0.325-5.181-0.325-5.181zM12.694 20.15v-8.994l8.644 4.513-8.644 4.481z"></path></svg></a></div> <div class="legal"><span class="copyright">Copyright  2019 by the openHAB Community and the openHAB Foundation e.V.</span> <br> <span class="legal-links"><a href="/v2.5/privacy.html">Privacy policy</a> |
    <a href="/v2.5/imprint.html">Imprint</a></span></div> <img src="/openhab-logo-square.png" class="footer-logo"></footer></div> <!----></div></div>
    <script src="/v2.5/assets/js/app.6e1f6232.js" defer></script><script src="/v2.5/assets/js/533.f219412f.js" defer></script><script src="/v2.5/assets/js/32.7c8f01a5.js" defer></script><script src="/v2.5/assets/js/33.df59480d.js" defer></script>
  </body>
</html>
